<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Démo Docker Swarm — Getting Started (Cours)</title>
  <style>
    :root{--bg:#071428;--card:#081826;--accent:#06b6d4;--muted:#9fb4c9}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;background:linear-gradient(180deg,#031322 0%,#07182a 100%);color:#e8f6fb;line-height:1.5}
    .container{max-width:980px;margin:28px auto;padding:24px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    header{display:flex;align-items:center;gap:16px}
    header h1{margin:0;font-size:20px}
    header p{margin:0;color:var(--muted);font-size:13px}
    nav{display:flex;gap:8px;flex-wrap:wrap;margin:16px 0}
    .badge{background:rgba(255,255,255,0.02);padding:8px 12px;border-radius:999px;color:var(--muted);font-size:13px}
    main{display:grid;grid-template-columns:1fr;gap:18px}
    section{background:var(--card);padding:14px;border-radius:10px}
    h2{margin:0 0 8px 0;font-size:16px;color:#dff8ff}
    p{margin:8px 0;color:#cfeff6}
    pre{background:#021622;padding:12px;border-radius:8px;overflow:auto;color:#d6fbff;font-size:13px}
    code{font-family: SFMono-Regular, Menlo, Monaco, 'Roboto Mono', monospace;background:rgba(255,255,255,0.02);padding:2px 6px;border-radius:6px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .kbd{background:#031926;padding:6px 8px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);font-family:monospace}
    .note{background:linear-gradient(90deg, rgba(6,182,212,0.06), rgba(96,165,250,0.03));padding:10px;border-radius:8px;color:var(--muted);font-size:13px}
    .cta{display:inline-block;padding:10px 14px;border-radius:8px;background:linear-gradient(90deg,var(--accent),#4ade80);color:#022;font-weight:700;text-decoration:none}
    footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px;color:var(--muted);font-size:13px}
    @media (max-width:700px){.container{margin:12px;padding:16px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div style="width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:flex;align-items:center;justify-content:center;color:#022;font-weight:800;font-size:18px">Sw</div>
      <div>
        <h1>Démo : Docker Swarm en action (Getting Started)</h1>
        <p>Un guide pas-à-pas pour déployer et observer Swarm avec ton vrai projet Node + MySQL.</p>
      </div>
    </header>

    <nav>
      <span class="badge">Pratique</span>
      <span class="badge">Swarm</span>
      <span class="badge">Getting Started</span>
    </nav>

    <main>

      <section>
        <h2>Étape 1 — Prépare ton projet</h2>
        <p>Assure-toi d'avoir ton répertoire contenant <code>compose.yaml</code>. Ajoute la section <code>deploy</code> pour activer le mode Swarm (exemple ci-dessous).</p>
        <pre><code>version: "3.9"

services:
  app:
    image: node:lts-alpine
    working_dir: /app
    command: sh -c "npm install && npm run dev"
    ports:
      - "3000:3000"
    volumes:
      - ./:/app
    environment:
      MYSQL_HOST: mysql
      MYSQL_USER: root
      MYSQL_PASSWORD: secret
      MYSQL_DB: todos
    deploy:
      replicas: 2
      restart_policy:
        condition: on-failure

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: secret
      MYSQL_DATABASE: todos
    volumes:
      - todo-mysql-data:/var/lib/mysql
    deploy:
      placement:
        constraints: [node.role == manager]

volumes:
  todo-mysql-data:
</code></pre>
        <p class="note">Remarque : dans un vrai cluster multi-nœuds, les volumes locaux ne sont pas portables entre machines. Pour la persistance en production, utilise un volume partagé ou un driver de volume.</p>
      </section>

      <section>
        <h2>Étape 2 — Active le mode Swarm</h2>
        <p>Dans un terminal sur ta machine hôte, exécute :</p>
        <pre><code>docker swarm init</code></pre>
        <p class="note">Si tu veux que les autres machines rejoignent le cluster, ré-exécute <code>docker swarm join-token worker</code> pour obtenir le token.</p>
      </section>

      <section>
        <h2>Étape 3 — Déploie la stack</h2>
        <p>Dans le dossier contenant ton <code>compose.yaml</code>, lance :</p>
        <pre><code>docker stack deploy -c compose.yaml todo-app</code></pre>
        <p>Docker va créer une stack Swarm appelée <code>todo-app</code>.</p>
      </section>

      <section>
        <h2>Étape 4 — Observe la magie</h2>
        <p>Commandes utiles pour vérifier l'état :</p>
        <pre><code>docker stack ls

docker service ls

docker ps</code></pre>
        <p>Exemple attendu :</p>
        <pre><code>NAME                  MODE         REPLICAS   IMAGE
todo-app_app          replicated   2/2        node:lts-alpine
todo-app_mysql        replicated   1/1        mysql:8.0</code></pre>
        <p>Tu verras 2 conteneurs <code>app</code> : Swarm les gère comme un seul service répliqué.</p>
      </section>

      <section>
        <h2>Étape 5 — Teste l'application</h2>
        <p>Ouvre ton navigateur :</p>
        <p class="row"><span class="kbd">http://localhost:3000</span></p>
        <p>Tu dois voir la même application Getting Started, mais maintenant :</p>
        <ul>
          <li>elle tourne en <strong>2 réplicas</strong>;</li>
          <li>Swarm réalise <strong>le load balancing</strong> automatiquement;</li>
          <li>Swarm peut <strong>redémarrer</strong> les conteneurs tombés en panne.</li>
        </ul>
      </section>

      <section>
        <h2>Étape 6 — Prouve-le (hautement recommandé)</h2>
        <p>1) Liste les conteneurs :</p>
        <pre><code>docker ps</code></pre>
        <p>Tu verras des containers nommés comme <code>todo-app_app.1.xxxx</code> et <code>todo-app_app.2.xxxx</code>.</p>
        <p>2) Supprime un conteneur à la main :</p>
        <pre><code>docker rm -f &lt;CONTAINER_ID&gt;</code></pre>
        <p>3) Regarde le statut du service :</p>
        <pre><code>docker service ps todo-app_app</code></pre>
        <p class="note">Résultat attendu : Swarm recrée automatiquement un conteneur pour maintenir les <code>2/2</code> réplicas — démonstration de la haute disponibilité.</p>
      </section>

      <section>
        <h2>Étape 7 — Scale up / down</h2>
        <p>Augmente le nombre de réplicas :</p>
        <pre><code>docker service scale todo-app_app=5</code></pre>
        <p>Puis réduis si besoin :</p>
        <pre><code>docker service scale todo-app_app=1</code></pre>
        <p>Swarm crée ou supprime les conteneurs automatiquement et répartit la charge.</p>
      </section>

      <section>
        <h2>Étape 8 — Nettoyer</h2>
        <p>Quand tu as fini, retire la stack et quitte le Swarm :</p>
        <pre><code>docker stack rm todo-app

docker swarm leave --force</code></pre>
      </section>

      <section>
        <h2>Résultat</h2>
        <p>En suivant ces étapes tu as :</p>
        <ul>
          <li>lancé un cluster Swarm local ;</li>
          <li>déployé une stack complète via un seul fichier YAML ;</li>
          <li>observé Swarm recréer et équilibrer des conteneurs automatiquement ;</li>
          <li>scalé ton app en une simple commande.</li>
        </ul>
        <p class="row"><a class="cta" href="#" onclick="alert('Copie les commandes depuis les blocs de code et exécute-les dans ton terminal')">Copier les commandes</a></p>
      </section>

    </main>

    <footer>
      <div>Besoin d'une version imprimable / PDF ?</div>
      <div class="badge">© Tutoriel Swarm</div>
    </footer>
  </div>
</body>
</html>